<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Connect Skills</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <link rel="stylesheet" href="/css/shared/style.css">
  <link rel="icon" type="image/png" href="/img/CONNECT.png?v=2">

    <style>
    :root { --nav-h: 0px !important; }
    body#home { padding-top: 0 !important; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
            color: #333;
        }

        .video-card {
            border: none;
            border-radius: 1.25rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        .upload-area {
            border: 2px dashed #cbd5e0;
            border-radius: 1rem;
            padding: 40px;
            text-align: center;
            transition: all 0.3s ease;
            background: #ffffff;
            cursor: pointer;
            position: relative;
        }

        .upload-area:hover, .upload-area.dragover {
            border-color: #0d6efd;
            background-color: #f0f7ff;
        }

        .upload-icon {
            font-size: 3.5rem;
            color: #0d6efd;
            margin-bottom: 1rem;
        }

        .video-preview-container {
            display: none;
            margin-top: 20px;
        }

        video {
            width: 100%;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            background: #000;
        }

        .step-indicator {
            background: #eef2f7;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 25px;
        }

        .btn-send {
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .btn-send:hover {
            transform: translateY(-2px);
        }

        /* Animação simples de loading */
        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.8);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
    </style>
</head>
<body>
  <%- include('../partials/header-empresa') %>
  <%- include('../partials/flash-messages') %>

<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
    <h5 class="mt-3">Enviando seu vídeo...</h5>
    <p class="text-muted">Isso pode levar alguns minutos dependendo do tamanho do arquivo.</p>
</div>
<div class="container mb-5">
    <div class="row justify-content-center">
        <div class="col-lg-7">
            
            <div class="card video-card">
                <div class="card-body p-4 p-md-5">
                    
                    <div class="d-flex align-items-center mb-4">
                        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 50px; height: 50px;">
                            <i class="fas fa-video fa-lg"></i>
                        </div>
                        <div>
                            <h3 class="mb-0 fw-bold text-dark">Envio de Vídeo</h3>
                            <p class="text-muted mb-0">Vaga: <strong><%= vaga.titulo %></strong></p>
                        </div>
                    </div>

                    <div class="step-indicator border-start border-warning border-4">
                        <p class="mb-1 text-dark"><strong><i class="fas fa-building me-2"></i>Empresa:</strong> <%= vaga.empresa.nome_fantasia || vaga.empresa.nome_empresa %></p>
                        <p class="mb-0 text-muted small"><i class="fas fa-clock me-2"></i>Prazo: Você tem <strong>3 dias</strong> para realizar este envio.</p>
                    </div>

                    <% if (locals.msgErro) { %>
                        <div class="alert alert-danger border-0 shadow-sm mb-4"><%= msgErro %></div>
                    <% } %>

                    <form action="/candidatos/vagas/upload-video" method="POST" enctype="multipart/form-data" id="uploadForm">
                        <input type="hidden" name="vagaId" value="<%= vaga.id %>">
                        
                        <div class="upload-area" id="dropZone">
                            <div id="instructionText">
                                <i class="fas fa-cloud-arrow-up upload-icon"></i>
                                <h5 class="fw-bold">Arraste seu vídeo aqui</h5>
                                <p class="text-muted mb-3">ou clique para selecionar o arquivo</p>
                                <span class="badge bg-light text-dark border">MP4, WEBM ou MOV</span>
                                <p class="small text-muted mt-2 text-uppercase" style="letter-spacing: 1px;">Máximo 50MB</p>
                            </div>

                            <div class="video-preview-container" id="previewContainer">
                                <video id="videoPlayer" controls></video>
                                <div class="mt-3">
                                    <button type="button" class="btn btn-sm btn-outline-danger" id="btnRemoveVideo">
                                        <i class="fas fa-trash me-2"></i>Trocar Vídeo
                                    </button>
                                </div>
                            </div>
                            
                            <input type="file" name="video" id="videoInput" class="d-none" accept="video/*" required>
                        </div>

                        <div class="alert alert-info mt-4 border-0" style="background-color: #e7f3ff;">
                            <h6 class="fw-bold"><i class="fas fa-lightbulb me-2 text-primary"></i>Dica de Ouro</h6>
                            <p class="small mb-0 text-dark">Fale brevemente sobre sua experiência e por que você é o candidato ideal para a vaga. Tente manter o vídeo entre 1 a 2 minutos.</p>
                        </div>

                        <div class="d-grid gap-2 mt-4">
                            <button type="submit" class="btn btn-primary btn-lg btn-send" id="btnSubmit" disabled>
                                <i class="fas fa-check-circle me-2"></i>Finalizar Inscrição
                            </button>
                            <a href="/candidatos/home" class="btn btn-link text-muted mt-2">Voltar depois</a>
                        </div>
                    </form>

                </div>
            </div>

            <p class="text-center text-muted mt-4 small">
                Sua conexão é segura. O vídeo será processado e armazenado em servidores criptografados.
            </p>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const dropZone = document.getElementById('dropZone');
    const videoInput = document.getElementById('videoInput');
    const previewContainer = document.getElementById('previewContainer');
    const instructionText = document.getElementById('instructionText');
    const videoPlayer = document.getElementById('videoPlayer');
    const btnRemoveVideo = document.getElementById('btnRemoveVideo');
    const btnSubmit = document.getElementById('btnSubmit');
    const uploadForm = document.getElementById('uploadForm');
    const loadingOverlay = document.getElementById('loadingOverlay');

    // Clique na área para abrir seletor
    dropZone.addEventListener('click', () => {
        if (videoInput.value === '') videoInput.click();
    });

    // Lógica de Preview
    videoInput.addEventListener('change', function() {
        handleFiles(this.files);
    });

    function handleFiles(files) {
        if (files.length > 0) {
            const file = files[0];
            
            // Validar se é vídeo
            if (!file.type.startsWith('video/')) {
                alert("Por favor, selecione um arquivo de vídeo válido.");
                return;
            }

            const url = URL.createObjectURL(file);
            videoPlayer.src = url;
            
            instructionText.style.display = 'none';
            previewContainer.style.display = 'block';
            btnSubmit.disabled = false;
        }
    }

    // Remover vídeo
    btnRemoveVideo.addEventListener('click', (e) => {
        e.stopPropagation();
        videoInput.value = '';
        videoPlayer.src = '';
        instructionText.style.display = 'block';
        previewContainer.style.display = 'none';
        btnSubmit.disabled = true;
    });

    // Drag and Drop Effects
    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
        });
    });

    dropZone.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        videoInput.files = files;
        handleFiles(files);
    });

    // Bloquear múltiplos envios e mostrar loading
    uploadForm.addEventListener('submit', () => {
        loadingOverlay.style.display = 'flex';
        btnSubmit.disabled = true;
    });
</script>

</body>
</html>